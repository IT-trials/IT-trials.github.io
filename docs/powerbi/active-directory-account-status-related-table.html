<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.24.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>AD User Account Status in PowerBI Model - IT Trials</title>
<meta name="description" content="Problem: I my previous posts I covered connecting PowerBI to AD and forming and returning user account data.">


  <meta name="author" content="Craig Chamberlain">
  
  <meta property="article:author" content="Craig Chamberlain">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_GB">
<meta property="og:site_name" content="IT Trials">
<meta property="og:title" content="AD User Account Status in PowerBI Model">
<meta property="og:url" content="https://it-trials.craigchamberlain.it/powerbi/active-directory-account-status-related-table">


  <meta property="og:description" content="Problem: I my previous posts I covered connecting PowerBI to AD and forming and returning user account data.">



  <meta property="og:image" content="https://it-trials.craigchamberlain.it/assets/images/it-trials.jpg">





  <meta property="article:published_time" content="2020-11-30T00:00:00+00:00">






<link rel="canonical" href="https://it-trials.craigchamberlain.it/powerbi/active-directory-account-status-related-table">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Craig Chamberlain",
      "url": "https://it-trials.craigchamberlain.it/",
      "sameAs": ["https://twitter.com/hagatorn","https://www.linkedin.com/in/craig-chamberlain-61037149","https://stackoverflow.com/users/3822155/craig-c"]
    
  }
</script>







<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="IT Trials Feed">


<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"></noscript>



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          IT Trials
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/aws/">AWS</a>
            </li><li class="masthead__menu-item">
              <a href="/azure/">Azure</a>
            </li><li class="masthead__menu-item">
              <a href="/gpo/">Group Policy</a>
            </li><li class="masthead__menu-item">
              <a href="/mdt/">MS Deployment Toolkit</a>
            </li><li class="masthead__menu-item">
              <a href="/scripting/">Scripting</a>
            </li></ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      
        <img src="/assets/images/authors/1.jpg" alt="Craig Chamberlain" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Craig Chamberlain</h3>
    
    
      <div class="author__bio" itemprop="description">
        <p>Developer</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      

      
        
          
            <li><a href="mailto:craig@craigchamberlain.it" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i><span class="label">Email</span></a></li>
          
        
          
            <li><a href="https://craigchamberlain.it" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-link" aria-hidden="true"></i><span class="label">Website</span></a></li>
          
        
          
            <li><a href="https://twitter.com/hagatorn" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i><span class="label">Twitter</span></a></li>
          
        
          
            <li><a href="https://stackoverflow.com/users/3822155/craig-c" rel="nofollow noopener noreferrer"><i class="fab fa-stack-overflow" aria-hidden="true"></i><span class="label">Stack Overflow</span></a></li>
          
        
          
            <li><a href="https://www.linkedin.com/in/craig-chamberlain-61037149" rel="nofollow noopener noreferrer"><i class="fab fa-linkedin" aria-hidden="true"></i><span class="label">LinkedIn</span></a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="AD User Account Status in PowerBI Model">
    <meta itemprop="description" content="Problem:I my previous posts I covered connecting PowerBI to AD and forming and returning user account data.">
    <meta itemprop="datePublished" content="2020-11-30T00:00:00+00:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Trial #34: AD User Account Status in PowerBI Model
</h1>
          

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2020-11-30T00:00:00+00:00">November 30, 2020</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          3 minute read
        
      </span>
    
  </p>


        </header>
      

      <section class="page__content" itemprop="text">
        
        <h2 id="problem">Problem:</h2>
<p>I my previous posts I covered connecting PowerBI to AD and forming and returning user account data.</p>

<p>However, on inspecting the results it is not clear if users are enabled, disabled or in any other given state.  This might be really important if you are attempting to use PowerBi to reconcile HR or other databases to ensure consistency.</p>

<h2 id="solution">Solution:</h2>

<p>The account status is quite readily accessible in the <code class="language-plaintext highlighter-rouge">userAccountControl</code> item of the <code class="language-plaintext highlighter-rouge">user</code> record.</p>

<figure>
	<img src="/assets/images/34/user-account-control.jpg" />
	<figcaption>
	Drill into the user column to find the userAccountControl field
	</figcaption>
</figure>

<p>However, userAccountControl is a <a href="&quot;https://en.wikipedia.org/wiki/Mask_(computing)&quot;" target="_blank">bit mask</a> and is not immediately comprehensible.</p>

<p>Some posts provide a simple explanation that 512 is enabled and 514 is disabled.  This is true, but not the complete story. This value actually encodes boolean values for 22 potentially independent options. Therefore there are 2^22 or 4,194,304 possible permutations of this number half of which are disabled, half of which are enabled.</p>

<p>Given the ponderous number of permutations and the relative unlikely occurrence of most of them it makes much more sense to extract meaning from the result using logic than using a related table.</p>

<p>Windows OS Hub have published an excellent article on this with a <a href="&quot;http://woshub.com/decoding-ad-useraccountcontrol-value/&quot;" target="_blank">PowerShell function</a> <a href="&quot;http://woshub.com/decoding-ad-useraccountcontrol-value/&quot;" target="_blank">PowerShell function</a></p>

<p>My first solution was to manually create a table limited to just the values that occur in my active directory, using the above PowerShell function, creating my own a pretty name and a boolean field to say if the account is disabled or enabled.</p>

<figure>
	<img src="/assets/images/34/account-status.jpg" />
	<figcaption>
	Form a many to one relationship between the OU table and the User table
	</figcaption>
</figure>

<p>This works perfectly well but I may have to add further rows as my active directory hosts more account status combinations.</p>

<p>It would be straight forward to make a function, using a bitwise operator, that determined if any given account was disabled or not.  This work be ideal as a custom column on your user table.</p>

<figure class="highlight"><pre><code class="language-powerquery" data-lang="powerquery">= (UAC as number)  =&gt;
    Number.BitwiseAnd(UAC, 2) = 2</code></pre></figure>

<p>To cover all eventualities, and provide the most options for filtering and chopping your user table, we could dynamically create a related table to help us resolve the <code class="language-plaintext highlighter-rouge">userAccountControl</code> bit map.</p>

<p>To start the process, I ported the Windows OS Hub, PowerShell function into PowerQuery.  I chose to return a list, rather than a combined string as it gives us the option to create a many to many relationship later on or serialise in a different form at a later point.</p>

<figure class="highlight"><pre><code class="language-powerquery" data-lang="powerquery">= (UAC as number) as list =&gt;
let 
  flags = {
    "SCRIPT",
    "ACCOUNTDISABLE",
    "RESERVED",
    "HOMEDIR_REQUIRED",
    "LOCKOUT",
    "PASSWD_NOTREQD",
    "PASSWD_CANT_CHANGE",
    "ENCRYPTED_TEXT_PWD_ALLOWED",
    "TEMP_DUPLICATE_ACCOUNT",
    "NORMAL_ACCOUNT",
    "RESERVED",
    "INTERDOMAIN_TRUST_ACCOUNT",
    "WORKSTATION_TRUST_ACCOUNT",
    "SERVER_TRUST_ACCOUNT",
    "RESERVED",
    "RESERVED",
    "DONT_EXPIRE_PASSWORD",
    "MNS_LOGON_ACCOUNT",
    "SMARTCARD_REQUIRED",
    "TRUSTED_FOR_DELEGATION",
    "NOT_DELEGATED",
    "USE_DES_KEY_ONLY",
    "DONT_REQ_PREAUTH",
    "PASSWORD_EXPIRED",
    "TRUSTED_TO_AUTH_FOR_DELEGATION",
    "RESERVED",
    "PARTIAL_SECRETS_ACCOUNT",
    "RESERVED",
    "RESERVED",
    "RESERVED",
    "RESERVED",
    "RESERVED"
  },
  attributes = "",
  enumerable = List.Numbers(0,List.Count(flags)),
  itterateBitMap = 
    List.Select(
      enumerable, 
      each Number.BitwiseAnd(UAC, Number.Power(2,_)) &lt;&gt; 0
    ),
  filteredFlags = List.Transform(itterateBitMap, each flags{_} )
in
  filteredFlags</code></pre></figure>

<p>Now we can then generate a the set of <code class="language-plaintext highlighter-rouge">userAccountControl</code> bit maps our <code class="language-plaintext highlighter-rouge">ActiveDirectory</code> currently contains and produce a computed result for each.</p>

<figure class="highlight"><pre><code class="language-powerquery" data-lang="powerquery">= let
userAccountControlCodes = List.RemoveNulls(List.Distinct(Table.Column(AllADUsers,"userAccountControl"))),
table1 = Table.FromList(userAccountControlCodes, Splitter.SplitByNothing(), {"userAccountControlCodes"}, null, ExtraValues.Error)
in 
Table.AddColumn(table1, "DecodedUAC", each DecodeUserAccountControl(_[userAccountControlCodes]) )</code></pre></figure>

<figure>
	<img src="/assets/images/34/resolved-user-account-control-bit-map.jpg" />
	<figcaption>
	A Dynamically Produced Table of All the Required userAccountControl Values and a human readable representation
	</figcaption>
</figure>

<p>At this point you may prefer to serialise the lists.  I recommend that you <code class="language-plaintext highlighter-rouge">Expand to New Rows</code> and use this to create a many to many relationship to your user table in PowerBI.</p>

<figure>
	<img src="/assets/images/34/resolved-user-account-control-bit-map-expanded.jpg" />
	<figcaption>
	A dynamically produced table of all the Required userAccountControl values and a human readable representation
	</figcaption>
</figure>

<h2>Other Posts in the PowerBI-AD Series:</h2>

<ul>


<li><a href="/powerbi/active-directory-account-status-related-table">Trial #34: AD User Account Status in PowerBI Model</a></li>

<li><a href="/powerbi/active-directory-groups-related-table">Trial #33: Querying AD Users Group Membership with PowerBI</a></li>

<li><a href="/powerbi/active-directory-ou-related-table">Trial #32: Making OUs More Readable with a Related Table in PowerBI Model</a></li>

<li><a href="/powerbi/active-directory-users-in-powerbi-model-transform-cn-to-ou">Trial #31: Transform Active Directory User CN to OU in PowerBI Model</a></li>

<li><a href="/powerbi/active-directory-users-in-powerbi-model">Trial #30: Accessing Active Directory Users in PowerBI Model</a></li>

</ul>

        
      </section>

      <footer class="page__meta">
        
        


        

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2020-11-30T00:00:00+00:00">November 30, 2020</time></p>


      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?text=AD+User+Account+Status+in+PowerBI+Model%20https%3A%2F%2Fit-trials.craigchamberlain.it%2Fpowerbi%2Factive-directory-account-status-related-table" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fit-trials.craigchamberlain.it%2Fpowerbi%2Factive-directory-account-status-related-table" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fit-trials.craigchamberlain.it%2Fpowerbi%2Factive-directory-account-status-related-table" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/powerbi/active-directory-groups-related-table" class="pagination--pager" title="Querying AD Users Group Membership with PowerBI
">Previous</a>
    
    
      <a href="/scripting/covid-tier-from-postcode" class="pagination--pager" title="Querying the gov.uk website for COVID-19 Tier by PostCode
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You may also enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/scripting/parsing-midyis-grade-exports" rel="permalink">Trial #38: Parsing and Transforming MidYIS grade export data
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2022-11-21T00:00:00+00:00">November 21, 2022</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          3 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Problem:
At the school at which I work, we had no way of importing our baseline MidYIS scores into our MIS and other custom reporting tools.  At times this i...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/scripting/parsing-alis-grade-exports" rel="permalink">Trial #37: Parsing and Transforming ALIS grade export data
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2022-11-21T00:00:00+00:00">November 21, 2022</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          1 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Problem:
At the school at which I work, we had no way of importing our baseline ALIS scores into our MIS and other custom reporting tools.  At times this inf...</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/powerbi/making-a-powerquery-post-request" rel="permalink">Trial #36: Making a PowerQuery (M) Http POST Request
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2021-01-04T00:00:00+00:00">January 4, 2021</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          1 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Problem:
PowerBi makes it very easy for you to make http GET requests, which can sometimes be done simply from navigating through a GUI.
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/scripting/covid-tier-from-postcode" rel="permalink">Trial #35: Querying the gov.uk website for COVID-19 Tier by PostCode
</a>
      
    </h2>
    

  <p class="page__meta">
    
      
      <span class="page__meta-date">
        <i class="far fa-fw fa-calendar-alt" aria-hidden="true"></i>
        
        <time datetime="2020-12-22T00:00:00+00:00">December 22, 2020</time>
      </span>
    

    <span class="page__meta-sep"></span>

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-fw fa-clock" aria-hidden="true"></i>
        
          1 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Problem:
The UK Government has a special COVID-19 Data Website.
</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

    </div>

    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    

    
      <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2022 IT Trials. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>







    
  <script>
    var disqus_config = function () {
      this.page.url = "https://it-trials.craigchamberlain.it/powerbi/active-directory-account-status-related-table";  /* Replace PAGE_URL with your page's canonical URL variable */
      this.page.identifier = "/powerbi/active-directory-account-status-related-table"; /* Replace PAGE_IDENTIFIER with your page's unique identifier variable */
    };
    (function() { /* DON'T EDIT BELOW THIS LINE */
      var d = document, s = d.createElement('script');
      s.src = 'https://ittrials.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


  





  </body>
</html>
